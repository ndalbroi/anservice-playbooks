---
- hosts: zabbixn
  remote_user: anserv
  become: true
  become_method: sudo
  become_user: root

  tasks:
  - name: Instalar agente zabbix
    apt:
      name: zabbix-agent
      state: present
      update_cache: yes
      
      

  - name: Cambiar linea "ListenPort" en /etc/zabbix/zabbix/zabbix_agentd.conf
    command: sed 's/# ListenPort=10050/'ListenPort=10050'/g' -i /etc/zabbix/zabbix/zabbix_agentd.conf
    register: result
    ignore_errors: yes

  - name: Reemplazar linea Server en /etc/zabbix/zabbix_agentd.conf
    command: sed 's/Server=127.0.0.1/'Server=192.168.100.83'/g' -i /etc/zabbix/zabbix/zabbix_agentd.conf
    register: result
    ignore_errors: yes

  - name: Reemplazar linea ServerActive en /etc/zabbix/zabbix_agentd.conf
    command: sed 's/ServerActive=127.0.0.1/'ServerActive=192.168.100.83'/g' -i /etc/zabbix/zabbix/zabbix_agentd.conf
    register: result
    ignore_errors: yes

  - name: Reemplazar linea EnableRemoteCommands en /etc/zabbix/zabbix_agentd.conf
    command: sed 's/# EnableRemoteCommands=0/'EnableRemoteCommands=1'/g' -i /etc/zabbix/zabbix/zabbix_agentd.conf
    register: result
    ignore_errors: yes
    
  - name: actualizar archivo zabbix
    command: zabbix_agentd -c /etc/zabbix/zabbix_agentd.conf
    register: result
    ignore_errors: yes

  - name: Reiniciar agente zabbix
    command: /etc/init.d/zabbix-agent restart
    register: result
    ignore_errors: yes
